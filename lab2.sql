-- 1. RIGHT JOIN: Н_ОЦЕНКИ и Н_ВЕДОМОСТИ
SELECT 
    Н_ОЦЕНКИ.КОД, 
    Н_ВЕДОМОСТИ.ИД
FROM 
    Н_ОЦЕНКИ
RIGHT JOIN (
    SELECT * 
    FROM Н_ВЕДОМОСТИ 
    WHERE ОЦЕНКА ~ '^[0-9]+$' -- Оставляем только числовые значения
) Н_ВЕДОМОСТИ
ON 
    CAST(Н_ОЦЕНКИ.КОД AS TEXT) = Н_ВЕДОМОСТИ.ОЦЕНКА -- Приведение к строковому типу
WHERE 
    CAST(Н_ОЦЕНКИ.КОД AS INTEGER) < 5 -- Приведение к INTEGER
    AND Н_ВЕДОМОСТИ.ЧЛВК_ИД = 153285
    AND Н_ВЕДОМОСТИ.ЧЛВК_ИД < 105590;

-- 2. LEFT JOIN: Н_ЛЮДИ, Н_ВЕДОМОСТИ и Н_СЕССИЯ
SELECT 
    Н_ЛЮДИ.ИМЯ, 
    Н_ВЕДОМОСТИ.ЧЛВК_ИД, 
    Н_СЕССИЯ.СЭС_ИД
FROM 
    Н_ЛЮДИ
LEFT JOIN 
    Н_ВЕДОМОСТИ 
ON 
    Н_ЛЮДИ.ИД = Н_ВЕДОМОСТИ.ЧЛВК_ИД -- Связь по колонке ЧЛВК_ИД
LEFT JOIN 
    Н_СЕССИЯ 
ON 
    Н_ВЕДОМОСТИ.СЭС_ИД = Н_СЕССИЯ.СЭС_ИД -- Связь по колонке СЭС_ИД
WHERE 
    Н_ЛЮДИ.ФАМИЛИЯ < 'Соколов'
    AND Н_ВЕДОМОСТИ.ИД < 1426978;

-- 3. Число студентов группы 3102 без отчества
SELECT 
    COUNT(*) AS Число_Студентов_Без_Отчества
FROM 
    Н_УЧЕНИКИ
JOIN 
    Н_ЛЮДИ
ON 
    Н_УЧЕНИКИ.ЧЛВК_ИД = Н_ЛЮДИ.ИД
WHERE 
    Н_УЧЕНИКИ.ГРУППА = '3102'
    AND Н_ЛЮДИ.ОТЧЕСТВО IS NULL;

-- 4. Различные отчества преподавателей, встречающиеся ровно 10 раз
SELECT 
    Н_ЛЮДИ.ОТЧЕСТВО, 
    COUNT(*) AS Число_Людей
FROM 
    Н_ЛЮДИ
GROUP BY 
    Н_ЛЮДИ.ОТЧЕСТВО
HAVING 
    COUNT(*) = 10;

-- 5. Средние оценки студентов группы 4100, сравнение с минимальной оценкой группы 1101
WITH Мин_Оценка_1101 AS (
    SELECT 
        MIN(СОРТ) AS Мин_Оценка -- Используем колонку СОРТ
    FROM 
        Н_ОЦЕНКИ
    WHERE 
        КОД = '1101' -- Убедитесь, что "ГРУППА" связана с КОД или уточните логику
)
SELECT 
    КОД AS НОМЕР, 
    ПРИМЕЧАНИЕ AS ФИО, 
    AVG(СОРТ) AS Ср_Оценка -- Используем колонку СОРТ
FROM 
    Н_ОЦЕНКИ
WHERE 
    КОД = '4100' -- Убедитесь, что "ГРУППА" связана с КОД
GROUP BY 
    КОД, ПРИМЕЧАНИЕ
HAVING 
    AVG(СОРТ) <= (SELECT Мин_Оценка FROM Мин_Оценка_1101);

-- 6. Список студентов, зачисленных после 1 сентября 2012 года
SELECT 
    УЧЕНИКИ.ГРУППА AS ГРУППА_НОМЕР, 
    ЛЮДИ.ИД AS НОМЕР, 
    ЛЮДИ.ФАМИЛИЯ, 
    ЛЮДИ.ИМЯ, 
    ЛЮДИ.ОТЧЕСТВО, 
    УЧЕНИКИ.ПЛАН_ИД AS ПУНКТ_НОМЕР, 
    УЧЕНИКИ.СОСТОЯНИЕ
FROM 
    Н_УЧЕНИКИ УЧЕНИКИ
INNER JOIN 
    Н_ЛЮДИ ЛЮДИ
ON 
    УЧЕНИКИ.ЧЛВК_ИД = ЛЮДИ.ИД
WHERE 
    УЧЕНИКИ.ВИД_ОБУЧ_ИД IN (1, 2) -- 1: Очная, 2: Заочная
    AND УЧЕНИКИ.КОГДА_СОЗДАЛ > '2012-09-01'
    AND УЧЕНИКИ.ГРУППА LIKE '1%'; -- Предполагаем, что номер курса начинается с "1"

-- 7. Люди, не являющиеся или не являвшиеся студентами СПбГУ ИТМО
SELECT 
    ЛЮДИ.ИД, 
    ЛЮДИ.ФАМИЛИЯ, 
    ЛЮДИ.ИМЯ, 
    ЛЮДИ.ОТЧЕСТВО
FROM 
    Н_ЛЮДИ ЛЮДИ
LEFT JOIN 
    Н_УЧЕНИКИ 
ON 
    ЛЮДИ.ИД = Н_УЧЕНИКИ.ЧЛВК_ИД
WHERE 
    Н_УЧЕНИКИ.ЧЛВК_ИД IS NULL;
